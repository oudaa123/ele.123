<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¬Ù…ÙŠØ¹ Ù…Ù†ØªØ¬Ø§Øª Ø¬Ù†Ø©</title>
<style>
body { font-family: Tahoma,sans-serif; margin:0; background:#f9f9f9; }

/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
header {
  background: #131921;
  color: white;
  padding: 15px;
  text-align: center;
  font-size: 20px;
  font-weight: bold;
  position: sticky;
  top: 0;
  z-index: 1000;
}
.header-buttons { margin-top: 10px; display: flex; flex-wrap: wrap; justify-content: center; gap:5px;}
.header-buttons button {
  background: #ffd814;
  border: 1px solid #fcd200;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}
.header-buttons button:hover { background: #f7ca00; }

/* Ø²Ø± Ø§Ù„Ø¬Ø±Ø³ */
#notifBtn {
  position: relative;
  background: #ff4444;
  border: 1px solid #cc0000;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  color: #fff;
}
#notif-count {
  position: absolute;
  top: -8px;
  right: -8px;
  background: yellow;
  color: black;
  font-size: 12px;
  font-weight: bold;
  padding: 2px 6px;
  border-radius: 50%;
  display: none;
}

/* Ø¨Ø§Ù†Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
#newBanner {
  display: none;
  background: red;
  color: white;
  text-align: center;
  padding: 10px;
  font-size: 20px;
  font-weight: bold;
}

/* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø© */
#cart-count {
  position: absolute;
  top: -8px;
  right: -8px;
  background: red;
  color: #fff;
  font-size: 12px;
  font-weight: bold;
  padding: 2px 6px;
  border-radius: 50%;
  display: none;
}

/* Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« */
#searchBox {
  display: block;
  margin: 10px auto;
  padding: 8px;
  width: 85%;
  max-width: 350px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

/* Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
#products-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 12px;
  padding: 15px;
}
.product {
  border: 1px solid #ccc;
  border-radius: 10px;
  padding: 10px;
  text-align: center;
  background: #fff;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  transition: 0.3s;
}
.product:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
.product img {
  width: 100%;
  height: 150px;
  object-fit: contain;
  margin-bottom: 8px;
}
.product .name { font-size: 16px; margin: 5px 0; color: #333; font-weight:bold; }
.product .price { font-weight: bold; margin-bottom: 5px; color:#8a2be2; }
.product input { width: 50px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; text-align: center; }
.product button {
  padding: 6px 10px;
  border: none;
  border-radius: 5px;
  background: #8a2be2;
  color: #fff;
  cursor: pointer;
  font-weight: bold;
  transition: 0.3s;
}
.product button:hover { background: #6a1fbf; transform: scale(1.05); }

/* Ù†Ø§ÙØ°Ø© Ø§Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø© */
#totalModal {
  display: none;
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%,-50%);
  background: #fff;
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 3px 15px rgba(0,0,0,0.3);
  text-align: center;
  z-index: 1002;
  width: 90%;
  max-width: 450px;
  max-height: 80%;
  overflow-y: auto;
}
#totalModal h2 { font-size: 20px; margin-bottom: 15px; color: #8a2be2; }
#totalModal button { margin:5px; padding:8px 15px; border:none; border-radius:10px; background:#8a2be2; color:#fff; cursor:pointer; font-weight:bold; transition:0.3s; }
#totalModal button:hover { background:#6a1fbf; }

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ù„Ø© */
#cartList { text-align: right; margin-bottom: 10px; }
.cart-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #ccc;
  padding: 5px 0;
  flex-wrap: wrap;
}
.cart-item span { margin: 0 5px; }
.cart-item button { padding: 2px 8px; font-size: 14px; }

/* Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØªØ­Øª Ø¨Ø¹Ø¶ */
#orderNumbers a { display: block; margin:5px 0; font-size:16px; color:#8a2be2; font-weight:bold; text-decoration:none; }
#orderNumbers a:hover { color:#6a1fbf; text-decoration:underline; }

/* Toast */
#toast {
  position: fixed;
  bottom: 20px; right: 20px;
  background: #25d366;
  color: #fff;
  padding: 10px 20px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  display: none;
  z-index: 1003;
}
</style>
</head>
<body>

<header>
  ğŸ“¦ Ø¬Ù…ÙŠØ¹ Ù…Ù†ØªØ¬Ø§Øª Ø¬Ù†Ø©
  <div class="header-buttons">
    <button id="cartBtn">ğŸ›’ Ø§Ù„Ø³Ù„Ø© <span id="cart-count">0</span></button>
    <button id="totalBtn">ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
    <button id="supportBtn">â˜ï¸ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</button>
    <button onclick="window.location.href='index.html'">ğŸ”™ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button id="notifBtn">ğŸ”” <span id="notif-count">0</span></button>
  </div>
  <input type="text" id="searchBox" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
</header>

<div id="newBanner">ğŸ‰ Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„ÙŠÙˆÙ…!</div>
<div id="products-container"></div>

<div id="totalModal">
  <h2>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <span id="totalAmount">0</span> Ø¬Ù†ÙŠÙ‡</h2>
  <div id="cartList"></div>
  <button id="sendBtn">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
  <button onclick="closeTotalModal()">âŒ Ø¥ØºÙ„Ø§Ù‚</button>
  <div id="orderNumbers" style="margin-top:10px; display:none;">
    <p>Ø§Ø®ØªØ± Ø±Ù‚Ù… Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ğŸ‘‡</p>
    <a href="https://wa.me/201067070423" target="_blank">ğŸ“ 01067070423</a>
    <a href="https://wa.me/201022495795" target="_blank">ğŸ“ 01022495795</a>
    <a href="https://wa.me/201012253500" target="_blank">ğŸ“ 01012253500</a>
  </div>
</div>

<div id="toast">ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</div>

<script defer>
const SCRIPT_PRODUCTS_URL = "https://script.google.com/macros/s/AKfycbxW3_pcjSfffMTLZefZpzFIrbhijiaWY_u_4ZAmXEV2O04SMN5zplucKnAugWWbP8zzmA/exec";
const container = document.getElementById("products-container");
let productsData = [];
let cart = [];

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨ÙƒÙØ§Ø¡Ø©
function renderProducts(data){
  container.innerHTML = "";
  const frag = document.createDocumentFragment();
  data.forEach((item,i)=>{
    const div = document.createElement("div");
    div.className="product";
    div.innerHTML=`
      <img src="${item.image||'https://via.placeholder.com/150'}">
      <div class="name">${item.name}</div>
      <div class="price">Ø§Ù„Ø³Ø¹Ø±: ${item.price} Ø¬Ù†ÙŠÙ‡</div>
      <input type="number" min="1" value="${cart[i]||1}" data-index="${i}">
      <button onclick="addToCart(${i})">Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</button>
    `;
    frag.appendChild(div);
  });
  container.appendChild(frag);
  updateCartCount();
}

// ØªØ­Ù…ÙŠÙ„ Ø³Ø±ÙŠØ¹ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª
(async function(){
  if(localStorage.getItem("products")){
    productsData=JSON.parse(localStorage.getItem("products"));
    renderProducts(productsData);
  }
  try{
    const res = await fetch(SCRIPT_PRODUCTS_URL,{cache:"no-store"});
    const data = await res.json();
    productsData = data.reverse();
    localStorage.setItem("products",JSON.stringify(productsData));
    renderProducts(productsData);
    setTimeout(checkNewProducts,1500);
  }catch(err){ console.log("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:",err);}
})();

function showToast(msg){
  const toast = document.getElementById("toast");
  toast.innerText=msg;
  toast.style.display="block";
  setTimeout(()=>toast.style.display="none",1200);
}

function updateCartCount(){
  const count = cart.reduce((sum, qty)=> qty ? sum+qty : sum, 0);
  const badge = document.getElementById("cart-count");
  badge.style.display = count>0?"inline-block":"none";
  badge.innerText=count;
}

function addToCart(index){
  const input = container.querySelector(`input[data-index='${index}']`);
  const quantity=parseInt(input.value);
  if(quantity<=0) return;
  cart[index] = (cart[index]||0)+quantity;
  updateCartCount();
  showToast(`${productsData[index].name} ØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡/ØªØ­Ø¯ÙŠØ«Ù‡ ÙÙŠ Ø§Ù„Ø³Ù„Ø©`);
}

// Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ Ø«Ø§Ø¨Øª
function showTotal(){
  const cartList = document.getElementById("cartList");
  cartList.innerHTML="";
  let total=0;
  cart.forEach((qty,idx)=>{
    if(!qty) return;
    const item = productsData[idx];
    const lineTotal = qty*item.price;
    total+=lineTotal;

    const div=document.createElement("div");
    div.className="cart-item";

    const nameSpan=document.createElement("span");
    nameSpan.innerText=item.name;

    const qtySpan=document.createElement("span");
    qtySpan.innerHTML=`Ø§Ù„Ø³Ø¹Ø±: ${item.price} Ã— `;
    const input=document.createElement("input");
    input.type="number"; input.min=1; input.value=qty; input.style.width="40px";
    input.onchange=()=>updateQty(idx,input.value);
    qtySpan.appendChild(input);
    qtySpan.innerHTML += ` = ${lineTotal} Ø¬Ù†ÙŠÙ‡`;

    const delBtn=document.createElement("button");
    delBtn.innerText="Ø­Ø°Ù"; delBtn.onclick=()=>removeItem(idx);

    div.appendChild(nameSpan);
    div.appendChild(qtySpan);
    div.appendChild(delBtn);
    cartList.appendChild(div);
  });
  document.getElementById("totalAmount").innerText=total;
  document.getElementById("totalModal").style.display="block";
}

function updateQty(idx,value){ value=parseInt(value); if(value<=0) delete cart[idx]; else cart[idx]=value; updateCartCount(); showTotal(); }
function removeItem(idx){ delete cart[idx]; updateCartCount(); showTotal(); }
function closeTotalModal(){ document.getElementById("totalModal").style.display='none'; }

// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
document.getElementById("sendBtn").onclick=function(){
  const orderDiv=document.getElementById("orderNumbers");
  orderDiv.style.display="block";
  orderDiv.querySelectorAll("a").forEach(a=>{
    a.onclick=(e)=>{
      e.preventDefault();
      let text="Ø·Ù„Ø¨ÙŠØ©:%0A%0A";
      let total=0;
      cart.forEach((qty,idx)=>{
        if(qty){
          const lineTotal=qty*productsData[idx].price;
          total+=lineTotal;
          text+=`${productsData[idx].name} Ã— ${qty} = ${lineTotal} Ø¬Ù†ÙŠÙ‡%0A`;
        }
      });
      text+=`%0AØ§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: ${total} Ø¬Ù†ÙŠÙ‡`;
      window.open(`${a.href}?text=${text}`,"_blank");
    }
  });
}

// Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‡ÙŠØ¯Ø±
document.getElementById("cartBtn").onclick=showTotal;
document.getElementById("totalBtn").onclick=showTotal;
document.getElementById("supportBtn").onclick=()=>window.open("https://wa.me/201022495795","_blank");

// Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
function checkNewProducts(){
  const today=(new Date()).toISOString().split("T")[0];
  let newCount=0;
  productsData.forEach(p=>{ if(p.date&&p.date.startsWith(today)) newCount++; });
  if(newCount>0){
    document.getElementById("notif-count").innerText=newCount;
    document.getElementById("notif-count").style.display="inline-block";
    document.getElementById("newBanner").style.display="block";
    let audio=new Audio("https://www.soundjay.com/buttons/sounds/button-3.mp3"); audio.play();
    if(Notification.permission==="granted") new Notification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${newCount} Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„ÙŠÙˆÙ… ğŸ‰`);
    else if(Notification.permission!=="denied") Notification.requestPermission().then(p=>{ if(p==="granted") new Notification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${newCount} Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„ÙŠÙˆÙ… ğŸ‰`); });
  }
}

// Ø§Ù„Ø¨Ø­Ø«
document.getElementById("searchBox").addEventListener("input", function(){
  const keyword=this.value.trim().toLowerCase();
  const filtered=productsData.filter(p=>p.name.toLowerCase().includes(keyword));
  renderProducts(filtered);
});
</script>
</body>
</html>
