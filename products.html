<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ุฌููุน ููุชุฌุงุช ุฌูุฉ - ุงููุณุฎุฉ ุงููุญุณูุฉ</title>
<style>
/* ุงูุฃููุงุท ุงูุฃุณุงุณูุฉ ุชุจูู ููุง ูู ูุน ุจุนุถ ุงูุชุญุณููุงุช */

/* ุชุญุณููุงุช ุดุฑูุท ุงูุชุตูููุงุช ูุฌุนูู ุฃูุซุฑ ุซุจุงุชุงู */
.categories-container {
  position: sticky;
  top: 120px;
  z-index: 999;
  background: white;
  border-bottom: 1px solid #ddd;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
}

/* ุชุฃุซูุฑ ุนูุฏ ุงูุชูุฑูุฑ */
.categories-container.scrolled {
  top: 60px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* ุชุญุณููุงุช ุงููุงุชูุฑุฉ */
.modal-content {
  max-height: 90vh;
  overflow-y: auto;
  transition: all 0.3s ease;
}

.modal-content.minimized {
  max-height: 200px;
  overflow: hidden;
}

.minimize-btn {
  position: absolute;
  top: 10px;
  right: 50px;
  background: #ffd814;
  color: #333;
  border: none;
  border-radius: 4px;
  width: 30px;
  height: 30px;
  cursor: pointer;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ุชุญุณููุงุช ุงูุฌุฏูู ูู ุงููุงุชูุฑุฉ */
.invoice-table {
  width: 100%;
  border-collapse: collapse;
  margin: 20px 0;
  font-size: 14px;
}

.invoice-table th {
  background-color: #8a2be2;
  color: white;
  padding: 10px 8px;
  text-align: center;
  font-weight: bold;
  position: sticky;
  top: 0;
  z-index: 10;
}

.invoice-table td {
  padding: 8px 6px;
  text-align: center;
  border-bottom: 1px solid #ddd;
  word-break: break-word;
}

/* ุชุญุณููุงุช ููููุชุฌุงุช ุงูุฌุฏูุฏุฉ */
.new-products-highlight {
  animation: highlight-pulse 2s infinite;
}

@keyframes highlight-pulse {
  0% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.4); }
  70% { box-shadow: 0 0 0 10px rgba(255, 68, 68, 0); }
  100% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0); }
}

/* ูุคุดุฑ ุงูุชุญุฏูุซ ุงูุชููุงุฆู */
.auto-update-indicator {
  position: fixed;
  top: 10px;
  right: 10px;
  background: #25d366;
  color: white;
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 12px;
  z-index: 1005;
  display: none;
  animation: blink 2s infinite;
}

@keyframes blink {
  0% { opacity: 1; }
  50% { opacity: 0.6; }
  100% { opacity: 1; }
}

/* ุชุญุณููุงุช ููุดุงุดุงุช ุงูุตุบูุฑุฉ */
@media (max-width: 768px) {
  .categories-container {
    top: 110px;
  }
  
  .categories-container.scrolled {
    top: 50px;
  }
  
  .invoice-table {
    font-size: 12px;
  }
  
  .invoice-table th,
  .invoice-table td {
    padding: 6px 4px;
  }
}

@media (max-width: 480px) {
  .categories-container {
    top: 100px;
  }
  
  .categories-container.scrolled {
    top: 40px;
  }
}
</style>
</head>
<body class="hide-price">

<!-- ุดุฑูุท ุงูููุชุฌุงุช ุงูุฌุฏูุฏุฉ ุงููุซุจุช -->
<div id="newProductsStickyBar" class="new-products-sticky-bar">
  ๐ ููุชุฌุงุช ุฌุฏูุฏุฉ ุงูููู! ูู ูุญุธุฉ ุนูุฏูุง ุฌุฏูุฏ ๐
</div>

<div id="showPricesBar" onclick="showPasswordModal()">
  ๐๏ธ ุงุนุฑุถ ุงูุฃุณุนุงุฑ
</div>

<!-- ูุคุดุฑ ุงูุชุญุฏูุซ ุงูุชููุงุฆู -->
<div id="autoUpdateIndicator" class="auto-update-indicator">๐ ุฌุงุฑู ุงูุชุญุฏูุซ</div>

<!-- ุจุงูู ุงููููู ุงูุฃุณุงุณู ูุจูู ููุง ูู -->
<header>
  ๐ฆELEC.123.ุชุงุฌ ูุฌููุน ููุชุฌุงุช ุฌูุฉ
  <div class="header-buttons">
    <button id="cartBtn">๐ ุงูุณูุฉ <span id="cart-count">0</span></button>
    <button id="totalBtn">๐ฐ ุงุฌูุงูู ุงููุงุชูุฑุฉ</button>
    <button onclick="window.location.href='index.html'">๐ ุงูุฑุฆูุณูุฉ</button>
    <button id="notifBtn">๐ ููุชุฌุงุช ุฌุฏูุฏู <span id="notif-count">0</span></button>
    <button id="clearCartBtn" onclick="clearCart()">๐๏ธ ูุณุญ ุงูุณูุฉ</button>
  </div>

  <div class="search-container">
    <input type="text" id="searchBox" placeholder="๐ุงุจุฏุฃ ู ุงุจุญุซ ุนู ููุชุฌ...">
    <button id="offerBtn">๐ฅุฎุตู ุฎุงุต ููููุงุฏูุจ</button>
  </div>

  <!-- ุงูุฃุฒุฑุงุฑ ุงูุฅุถุงููุฉ ุชุญุช ุงูุจุญุซ -->
  <div class="additional-buttons">
    <button class="support-button" onclick="window.open('https://wa.me/201022495795', '_blank')">
      โ๏ธ ุงูุฏุนู ุงูููู
    </button>
    <button class="request-product-button" onclick="openProductRequestModal()">
      ๐ฆ ุทูุจ ููุชุฌ ุบูุฑ ูุชููุฑ
    </button>
  </div>
</header>

<!-- ุดุฑูุท ุงูุชุตูููุงุช ุงููุญุณู ูุงููุซุจุช -->
<div class="categories-container" id="categoriesContainer">
  <div class="categories-bar" id="categoriesBar">
    <button class="category-btn active" data-category="all">ุงููู</button>
    <button class="category-btn" data-category="ุตุจ">ุงูุตุจุงุช</button>
    <button class="category-btn" data-category="ูุงุจู">ุงููุงุจูุงุช</button>
    <button class="category-btn" data-category="ุดุงุญู">ุงูุดูุงุญู</button>
    <button class="category-btn" data-category="ุฌุฑุงุจ">ุงูุฌุฑุงุจุงุช</button>
    <button class="category-btn" data-category="ุงุณูุฑูู">ุงูุงุณูุฑููุงุช</button>
    <button class="category-btn" data-category="ุณูุงุนุฉ">ุงูุณูุงุนุงุช</button>
    <button class="category-btn" data-category="ุจุทุงุฑูุฉ">ุงูุจุทุงุฑูุงุช</button>
    <button class="category-btn" data-category="ุงุฎุฑู">ููุชุฌุงุช ุฃุฎุฑู</button>
  </div>
</div>

<!-- ุจุงูู ุงููููู ูุจูู ููุง ูู -->
<div id="newBanner">๐ ููุชุฌุงุช ุฌุฏูุฏุฉ ุงูููู!</div>

<div id="main-products-page">
  <div id="products-container" class="products-grid">
    <div class="products-loading">
      <div class="loading-spinner"></div>
      <div>ุฌุงุฑู ุชุญููู ุงูููุชุฌุงุช...</div>
      <div class="loading-progress">
        <div class="loading-progress-bar" id="loadingProgressBar"></div>
      </div>
      <div id="loadingStatus" style="font-size: 14px; color: #666;">ุฌุงุฑู ุงูุชุญุถูุฑ</div>
    </div>
  </div>
</div>

<!-- ุงููุงุชูุฑุฉ ุงููุญุณูุฉ -->
<div id="totalModal">
  <div class="modal-content" id="invoiceContent">
    <button class="modal-close" onclick="closeTotalModal()">ร</button>
    <button class="minimize-btn" id="minimizeBtn" onclick="toggleInvoiceMinimize()">โ</button>
    
    <div class="invoice-header">
      <h1 class="invoice-title">ุฌูุฉ</h1>
      <h2 class="invoice-subtitle">ูุฌููุน ุฃูุณุณูุงุฑุงุช ุงููุญููู</h2>
      <div class="invoice-date" id="invoiceDate"></div>
      
      <div class="invoice-summary">
        <div class="summary-item">
          <span>ุฅุฌูุงูู ุงูููุชุฌุงุช:</span>
          <span id="productsTotal">0.00 ุฌููู</span>
        </div>
        <div class="summary-item">
          <span>ุชูููุฉ ุงูุดุญู:</span>
          <span id="shippingCostBreakdown">0.00 ุฌููู</span>
        </div>
        <div class="summary-item summary-total">
          <span>ุงููุฌููุน ุงูููุงุฆู:</span>
          <span id="finalTotalBreakdown">0.00 ุฌููู</span>
        </div>
      </div>
    </div>
    
    <div id="invoiceDetails">
      <table class="invoice-table">
        <thead>
          <tr>
            <th>ุงุณู ุงูุตูู</th>
            <th>ุงููููุฉ</th>
            <th>ุงูุณุนุฑ</th>
            <th>ุงููุฌููุน</th>
            <th>ุงูุฅุฌุฑุงุกุงุช</th>
          </tr>
        </thead>
        <tbody id="cartList">
        </tbody>
      </table>
      
      <div class="modal-buttons">
        <button id="sendBtn">๐ค ุงุฑุณู ูุงุชูุฑุชู ูุงุณุชูููุง ูู ุงูู ูู 12 ุณุงุนู</button>
        <button onclick="saveInvoiceWithDate()">๐พ ุงุญูุธ ุงููุงุชูุฑู ุจุชุงุฑูุฎ</button>
        <button onclick="closeTotalModal()">โ ุฅุบูุงู</button>
      </div>
      
      <!-- ูุณู ุงูููุงุชูุฑ ุงููุญููุธุฉ -->
      <div id="savedInvoices" class="saved-invoices">
        <h3 style="text-align: center; margin: 20px 0 10px; color: var(--primary-color);">ุงูููุงุชูุฑ ุงููุญููุธุฉ</h3>
        <div id="savedInvoicesList"></div>
      </div>
    </div>
  </div>
</div>

<!-- ุจุงูู ุงูุนูุงุตุฑ ุชุจูู ููุง ูู -->

<script>
// ุฅุนุฏุงุฏุงุช ุงูุชุทุจูู ุงููุญุณูุฉ
const SCRIPT_PRODUCTS_URL = "https://script.google.com/macros/s/AKfycbxQCsDkj7GP1HPc8YfLuIIiQxval8l3OpapKN8TuHdGXiP_5juG_9CMQ1qSbVLGCcV9lg/exec";
const container = document.getElementById("products-container");
let productsData = [];
let cart = [];
let pricesVisible = false;
let newProductsCount = 0;
let isSearching = false;
let currentSearchTerm = "";
let currentCategory = "all";
let autoUpdateInterval;
let isInvoiceMinimized = false;

// ุฅุนุฏุงุฏุงุช ุงูุดุญู ุงููุฌุงูู
const FREE_SHIPPING_THRESHOLD = 500;
const SHIPPING_COST = 50;

const PASSWORD = "2525";

// ุฅุถุงูุฉ ูุชุบูุฑ ุฌุฏูุฏ ูุชุฎุฒูู ุงูููุงุชูุฑ ุงููุญููุธุฉ
let savedInvoices = JSON.parse(localStorage.getItem('savedInvoices')) || [];

// ุฏุงูุฉ ูุญุณูุฉ ูุชุซุจูุช ุดุฑูุท ุงูุชุตูููุงุช
function handleCategoriesSticky() {
  const categoriesContainer = document.getElementById('categoriesContainer');
  const header = document.querySelector('header');
  
  window.addEventListener('scroll', function() {
    if (window.scrollY > 100) {
      categoriesContainer.classList.add('scrolled');
    } else {
      categoriesContainer.classList.remove('scrolled');
    }
  });
}

// ุฏุงูุฉ ุชุญุณูู ุชูุธูู ุงููุงุชูุฑุฉ
function toggleInvoiceMinimize() {
  const invoiceContent = document.getElementById('invoiceContent');
  const minimizeBtn = document.getElementById('minimizeBtn');
  const invoiceDetails = document.getElementById('invoiceDetails');
  
  if (isInvoiceMinimized) {
    // ุชูุจูุฑ ุงููุงุชูุฑุฉ
    invoiceContent.classList.remove('minimized');
    invoiceDetails.style.display = 'block';
    minimizeBtn.textContent = 'โ';
    isInvoiceMinimized = false;
  } else {
    // ุชุตุบูุฑ ุงููุงุชูุฑุฉ
    invoiceContent.classList.add('minimized');
    invoiceDetails.style.display = 'none';
    minimizeBtn.textContent = '+';
    isInvoiceMinimized = true;
  }
}

// ุฏุงูุฉ ูุญุณูุฉ ููุชุญุฏูุซ ุงูุชููุงุฆู ูู 30 ุซุงููุฉ
function initializeAutoUpdate() {
  // ุชุญุฏูุซ ุงูููุชุฌุงุช ูู 30 ุซุงููุฉ
  autoUpdateInterval = setInterval(async () => {
    try {
      // ุฅุธูุงุฑ ูุคุดุฑ ุงูุชุญุฏูุซ
      document.getElementById('autoUpdateIndicator').style.display = 'block';
      
      // ุญูุธ ุงูููุชุฌุงุช ุงูุญุงููุฉ ููุชุญูู ูู ุงูุฌุฏูุฏ
      const oldProducts = [...productsData];
      
      // ุฌูุจ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ
      await fetchProducts();
      
      // ุงูุชุญูู ูู ุงูููุชุฌุงุช ุงูุฌุฏูุฏุฉ
      const newProducts = checkForNewProducts(oldProducts, productsData);
      
      // ุฅุฐุง ูุงู ููุงู ููุชุฌุงุช ุฌุฏูุฏุฉุ ุนุฑุถ ุฅุดุนุงุฑ
      if (newProducts.length > 0) {
        showNewProductsNotification();
        highlightNewProducts(newProducts);
      }
      
      // ุฅุฎูุงุก ูุคุดุฑ ุงูุชุญุฏูุซ ุจุนุฏ ุซุงููุชูู
      setTimeout(() => {
        document.getElementById('autoUpdateIndicator').style.display = 'none';
      }, 2000);
      
    } catch (error) {
      console.error('ุฎุทุฃ ูู ุงูุชุญุฏูุซ ุงูุชููุงุฆู:', error);
      document.getElementById('autoUpdateIndicator').style.display = 'none';
    }
  }, 30000); // 30 ุซุงููุฉ
}

// ุฏุงูุฉ ูุชุณููุท ุงูุถูุก ุนูู ุงูููุชุฌุงุช ุงูุฌุฏูุฏุฉ
function highlightNewProducts(newProducts) {
  // ุฅุฒุงูุฉ ุงูุชูููุฒ ุงูุณุงุจู
  document.querySelectorAll('.new-products-highlight').forEach(el => {
    el.classList.remove('new-products-highlight');
  });
  
  // ุชูููุฒ ุงูููุชุฌุงุช ุงูุฌุฏูุฏุฉ
  newProducts.forEach(product => {
    const productIndex = productsData.findIndex(p => p.name === product.name);
    if (productIndex !== -1) {
      const productElement = document.querySelector(`.product-item:nth-child(${productIndex + 1})`);
      if (productElement) {
        productElement.classList.add('new-products-highlight');
        
        // ุฅุฒุงูุฉ ุงูุชูููุฒ ุจุนุฏ 5 ุซูุงูู
        setTimeout(() => {
          productElement.classList.remove('new-products-highlight');
        }, 5000);
      }
    }
  });
}

// ุฏุงูุฉ ูุญุณูุฉ ูุนุฑุถ ุงูููุชุฌุงุช ูุน ุฏุนู ุงูุชูููุฒ ููููุชุฌุงุช ุงูุฌุฏูุฏุฉ
function renderProducts(data, containerElement){
  let html = "";
  
  if (data.length === 0) {
    html = `<div style="text-align: center; padding: 20px; color: #666;">ูุง ุชูุฌุฏ ููุชุฌุงุช ูุนุฑุถูุง</div>`;
  } else {
    data.forEach((item, index) => {
      const formattedPrice = formatPrice(item.price);
      
      // ุงููุดู ุนู ุงูููุชุฌุงุช ุงูุฌุฏูุฏุฉ ุจูุงุกู ุนูู ูุฌูุฏ ".." ูู ุงูุงุณู
      const isNewProduct = item.name && item.name.includes("..");
      
      // ุงููุดู ุนู ุงูููุชุฌุงุช ุฐุงุช ุงูุนุฑูุถ ุจูุงุกู ุนูู ูุฌูุฏ "&" ูู ุงูุงุณู
      const isOfferProduct = item.name && item.name.includes("&");
      
      // ุงููุดู ุนู ุงูููุชุฌุงุช ุบูุฑ ุงููุชููุฑุฉ ุจูุงุกู ุนูู ูุฌูุฏ "@" ูู ุงูุงุณู
      const isOutOfStockProduct = isOutOfStock(item.name);
      
      // ุงููุดู ุนู ุงูููุชุฌุงุช ุฐุงุช ุงูุดุญู ุงููุฌุงูู ุจูุงุกู ุนูู ูุฌูุฏ "#" ูู ุงูุงุณู
      const isFreeShippingProduct = hasFreeShipping(item.name);
      
      // ุงุณุชุฎุฏุงู ุงูุงุณู ุงููุธูู ูุงูููุณู ููุนุฑุถ
      const displayName = cleanProductName(item.name);
      
      // ุญุณุงุจ ุงูุณุนุฑ ุจุนุฏ ุฒูุงุฏุฉ 45% ููููุชุฌุงุช ุงูุชู ุชุญุชูู ุนูู "&"
      const originalPrice = parseFloat(item.price) || 0;
      const increasedPrice = isOfferProduct ? originalPrice * 1.45 : originalPrice;
      
      html += `<div class="product-item ${isNewProduct ? 'new-product' : ''} ${isOfferProduct ? 'offer-product' : ''} ${isOutOfStockProduct ? 'out-of-stock' : ''} ${isFreeShippingProduct ? 'free-shipping-product' : ''}">
                  ${isNewProduct ? '<span class="new-product-badge">๐ ุฌุฏูุฏ</span>' : ''}
                  ${isOfferProduct ? '<span class="offer-product-badge">๐ ุนุฑุถ ุฎุงุต</span>' : ''}
                  ${isFreeShippingProduct ? '<span class="free-shipping-badge">๐ ุดุญู ูุฌุงูู</span>' : ''}
                  ${isOutOfStockProduct ? '<div class="out-of-stock-overlay"></div><div class="out-of-stock-badge">โ ุบูุฑ ูุชููุฑ</div>' : ''}
                  <div class="product-image-container">
                    <img src="${item.image || 'https://via.placeholder.com/200'}" 
                         onerror="handleImageError(this)" 
                         alt="${item.name}" 
                         loading="lazy">
                  </div>
                  <div class="product-info">
                    <div class="product-name">${displayName}</div>
                    ${isOfferProduct ? 
                      `<div class="product-price original-price">${formatPrice(increasedPrice)} ุฌููู</div>
                       <div class="product-price discount-price">
                         <span class="discount-percent">ุฎุตู 45%</span>${formatPrice(originalPrice)} ุฌููู
                       </div>` : 
                      `<div class="product-price ${isOutOfStockProduct ? 'out-of-stock-price' : ''}">${formattedPrice} ุฌููู</div>`
                    }
                    ${!isOutOfStockProduct ? 
                      `<div class="product-controls">
                         <input type="number" class="quantity-input" min="1" value="${cart[index] || 1}" data-index="${index}">
                         <button class="add-to-cart-btn" onclick="addToCart(${index})">ุฃุถู ุฅูู ุงูุณูุฉ</button>
                       </div>` : 
                      `<div class="product-controls">
                         <div style="height: 50px; display: flex; align-items: center; justify-content: center; color: #ff4444; font-weight: bold;">
                           โ ุบูุฑ ูุชููุฑ ุญุงููุงู
                         </div>
                       </div>`}
                  </div>
               </div>`;
    });
  }
  
  containerElement.innerHTML = html;
  
  // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ ูุญููู ุงููููุฉ (ููููุชุฌุงุช ุงููุชููุฑุฉ ููุท)
  containerElement.querySelectorAll('.quantity-input').forEach(input => {
    input.addEventListener('change', function() {
      const index = parseInt(this.getAttribute('data-index'));
      const value = parseInt(this.value);
      updateQty(index, value);
    });
  });
  
  togglePricesVisibility();
}

// ุจุงูู ุงูุฏูุงู ุชุจูู ููุง ูู ูุน ุจุนุถ ุงูุชุญุณููุงุช ุงูุทูููุฉ

// ุชููุฆุฉ ุงูุตูุญุฉ ุงููุญุณูุฉ
document.addEventListener('DOMContentLoaded', function() {
  // ุชุญููู ุงูููุชุฌุงุช ูู API
  fetchProducts();
  
  // ุจุฏุก ุงูุชุญุฏูุซ ุงูุชููุงุฆู ูู 30 ุซุงููุฉ
  initializeAutoUpdate();
  
  // ุชุญููู ุงูุณูุฉ ุงููุญููุธุฉ
  loadSavedCart();
  
  // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ ูุฃุฒุฑุงุฑ ุงูุชุตูููุงุช
  document.querySelectorAll('.category-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const category = this.getAttribute('data-category');
      filterProductsByCategory(category);
    });
  });
  
  // ุชูุนูู ุชุซุจูุช ุดุฑูุท ุงูุชุตูููุงุช
  handleCategoriesSticky();
  
  // ุจุงูู ูุณุชูุนู ุงูุฃุญุฏุงุซ
  document.getElementById("searchBox").addEventListener("input", performSearch);
  document.getElementById("cartBtn").onclick = showTotal;
  document.getElementById("totalBtn").onclick = showTotal;
  
  document.getElementById('passwordInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      checkPassword();
    }
  });
  
  // ุชุญุฏูุซ ุฒุฑ ุญูุธ ุงูุณูุฉ
  setInterval(() => {
    const cartCount = cart.reduce((sum, qty) => qty ? sum + qty : sum, 0);
    document.getElementById('saveCartBtn').style.display = cartCount > 0 ? 'flex' : 'none';
  }, 1000);
});
</script>
</body>
</html>
