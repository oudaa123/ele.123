function formatPrice(price) {
  if (price === null || price === undefined || price === '' || price === 'NaN') {
    return "0.00";
  }
  
  const numericPrice = parseFloat(price);
  
  if (isNaN(numericPrice)) {
    return "0.00";
  }
  
  return numericPrice.toFixed(2);
}

// دالة محسنة لعرض المنتجات
function displayProducts(products) {
  if (!container) return;
  
  container.innerHTML = '';
  
  if (!products || products.length === 0) {
    container.innerHTML = '<div class="loading">⚠️ لا توجد منتجات متاحة حالياً</div>';
    return;
  }
  
  // تحديث وقت آخر تحديث
  lastUpdateTime = Date.now();
  
  // حساب المنتجات الجديدة
  newProductsCount = products.filter(product => product.isNew).length;
  
  products.forEach((product, index) => {
    const productDiv = document.createElement('div');
    productDiv.className = 'product';
    
    // إضافة كلاسات خاصة للمنتجات الجديدة والعروض
    if (product.isNew) {
      productDiv.classList.add('new-product');
    }
    if (product.isSpecial) {
      productDiv.classList.add('special-offer');
    }
    
    productDiv.innerHTML = `
      ${product.isNew ? '<div class="new-badge">🆕 جديد</div>' : ''}
      ${product.isSpecial ? '<div class="special-badge">✨ عرض خاص</div>' : ''}
      ${product.discount ? `<div class="discount-label">خصم ${product.discount}%</div>` : ''}
      
      <div class="image-container">
        ${product.image ? 
          `<img src="${product.image}" alt="${product.name}" loading="lazy" onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=\'image-placeholder\'>⚠️ تعذر تحميل
