<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>جميع منتجات جنة</title>
  <style>
    body {
      font-family: "Tahoma", sans-serif;
      margin: 0;
      background: #f4f4f4;
    }
    header {
      background: #232f3e;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
    }
    #products-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 15px;
      padding: 15px;
    }
    .product {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 10px;
      text-align: center;
    }
    .product img {
      width: 100%;
      max-height: 120px;
      object-fit: contain;
      margin-bottom: 10px;
    }
    .name {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 5px;
      min-height: 40px;
    }
    .price {
      color: #b12704;
      margin-bottom: 10px;
      font-size: 14px;
    }
    button {
      background: #ffa41c;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { background: #f90; }
    #footer {
      background: #232f3e;
      color: white;
      padding: 15px;
      text-align: center;
    }
    #footer a {
      display: inline-block;
      background: #25d366;
      color: white;
      padding: 10px 15px;
      border-radius: 20px;
      font-weight: bold;
      text-decoration: none;
    }
    #footer a:hover { background: #1ebe5b; }
    /* المودال */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    .cart-item { margin-bottom: 10px; font-size: 14px; }
  </style>
</head>
<body>
  <header>🛒 جميع منتجات جنة</header>

  <div id="products-container"></div>

  <!-- المودال -->
  <div id="totalModal" class="modal">
    <div class="modal-content">
      <h3>🛍️ الفاتورة</h3>
      <div id="cartList"></div>
      <h4>الإجمالي: <span id="totalAmount">0</span> جنيه</h4>
      <button onclick="sendOrder()">إرسال الطلب</button>
      <button onclick="closeTotalModal()">إغلاق</button>
    </div>
  </div>

  <div id="footer">
    <button onclick="showTotal()">🧾 عرض الفاتورة</button>
    <a href="https://wa.me/201022495795" target="_blank">💬 الدعم الفني - </a>
  </div>

  <script>
    const SCRIPT_PRODUCTS_URL = "https://script.google.com/macros/s/AKfycbxW3_pcjSfffMTLZefZpzFIrbhijiaWY_u_4ZAmXEV2O04SMN5zplucKnAugWWbP8zzmA/exec";
    const container = document.getElementById("products-container");
    let productsData = [];
    let cart = [];

    // تحميل المنتجات
    fetch(SCRIPT_PRODUCTS_URL)
    .then(res => res.json())
    .then(data => {
      const today = new Date();
      productsData = data.map(item => {
        item.addedDate = item.addedDate ? new Date(item.addedDate) : null;
        const diffDays = item.addedDate ? Math.floor((today - item.addedDate) / (1000*60*60*24)) : 999;
        item.isNew = diffDays <= 20;
        return item;
      });

      // الجديد يظهر في الأول
      productsData.sort((a,b)=>b.isNew - a.isNew);

      container.innerHTML = "";
      for(let i=0;i<productsData.length;i++){
        const item = productsData[i];
        const div = document.createElement("div");
        div.className = "product";
        div.innerHTML = `
          ${item.image ? `<img src="${item.image}" alt="${item.name}">` : ""}
          <div class="name">${item.name} ${item.isNew ? '<span style="color:red;">⭐ جديد</span>' : ''}</div>
          <div class="price">السعر: ${item.price} جنيه</div>
          <input type="number" min="1" value="1" data-index="${i}">
          <button onclick="addToCart(${i})">إضافة للسلة</button>
        `;
        container.appendChild(div);
      }
    });

    function addToCart(index){
      const input = container.querySelector(`input[data-index='${index}']`);
      const qty = parseInt(input.value);
      if(qty<=0) return;
      cart[index]=qty;
      alert(`${productsData[index].name} تمت إضافته للسلة`);
    }

    function showTotal(){
      let total=0;
      const cartList=document.getElementById("cartList");
      cartList.innerHTML="";
      cart.forEach((qty,idx)=>{
        if(qty){
          total+=qty*productsData[idx].price;
          cartList.innerHTML+=`
            <div class="cart-item">
              ${productsData[idx].name} × ${qty} = <strong>${qty*productsData[idx].price}</strong> جنيه
            </div>
          `;
        }
      });
      document.getElementById("totalAmount").innerText=total;
      document.getElementById("totalModal").style.display="flex";
    }

    function closeTotalModal(){ document.getElementById("totalModal").style.display="none"; }

    function sendOrder(){
      let orderText="طلبية:%0A";
      cart.forEach((qty,idx)=>{
        if(qty){
          orderText+=`${productsData[idx].name} × ${qty} = ${qty*productsData[idx].price} جنيه%0A`;
        }
      });
      const total=cart.reduce((sum,qty,idx)=>qty?sum+qty*productsData[idx].price:sum,0);
      orderText+=`الإجمالي: ${total} جنيه`;
      window.open(`https://wa.me/201022495795?text=${orderText}`,"_blank");
    }
  </script>
</body>
</html>
